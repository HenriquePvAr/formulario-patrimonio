<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formul√°rio Patrim√¥nio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style> 
    .form-container {max-width:750px;margin:40px auto;padding:24px;background:#fff;border-radius:10px} 
  </style>
</head>
<body>
  <div class="form-container">
    <h3>Formul√°rio de Patrim√¥nio</h3>

    <form id="patrimonioForm" novalidate>
      <div class="mb-3">
        <label>Usu√°rio</label>
        <input id="Usuario" pattern="^[A-Za-z√Ä-√ø\s]+$" title="Apenas letras e espa√ßos" class="form-control"/>
      </div>

      <div class="mb-3">
        <label>Patrim√¥nio Computador</label>
        <input id="pc" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" title="At√© 7 d√≠gitos" class="form-control patrimonio"/>
      </div>

      <div class="mb-3">
        <label>Lacre</label>
        <input id="lacre" class="form-control"/>
      </div>

      <div class="mb-3">
        <label>Monitor 1</label>
        <input id="monitor" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
      </div>

      <div class="mb-3">
        <label>Monitor 2 (opcional)</label>
        <input id="monitor2" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
      </div>

      <div class="mb-3">
        <label>Monitor 3 (opcional)</label>
        <input id="monitor3" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
      </div>

      <div class="mb-3">
        <label>Mesa</label>
        <input id="mesa" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
      </div>

      <div class="mb-3">
        <label>Telefone</label>
        <input id="telefone" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
      </div>

      <div class="mb-3">
        <label>Gaveteiro</label>
        <input id="gaveteiro" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
      </div>

      <div class="mb-3">
        <label>Setor</label>
        <select id="setor" class="form-select">
          <option value="" disabled selected>Selecione</option>
          <option>Almoxarifado</option>
          <option>Anavilhanas</option>
          <option>Brigadista</option>
          <option>Comunica√ß√£o Social</option>
          <option>Diretoria</option>
          <option>Gabinete</option>
          <option>Hidrologia</option>
          <option>Juami Japur√°</option>
          <option>Meteorologia</option>
          <option>Nugep</option>
          <option>Paic</option>
          <option>Pico da Neblina</option>
          <option>Protocolo</option>
          <option>Recep√ß√£o</option>
          <option>Sala de Treinamento</option>
          <option>Seadm</option>
          <option>Seint</option>
          <option>Setec</option>
          <option>Seguran√ßa Org√¢nica</option>
        </select>
      </div>

      <div class="mb-3">
        <label>Informa√ß√µes Adicionais</label>
        <textarea id="additionalInfo" class="form-control"></textarea>
      </div>

      <div class="mb-3">
        <label>A√ß√£o</label>
        <select id="acao" class="form-select">
          <option value="" disabled selected>Escolha</option>
          <option value="planilha">Enviar para planilha</option>
          <option value="email">Enviar por email</option>
          <option value="planilha_email">Planilha por email</option>
        </select>
      </div>

      <button class="btn btn-primary w-100" type="submit">Enviar</button>
    </form>

    <!-- Novo bot√£o fora do formul√°rio -->
    <hr>
    <button id="btnEnviarPlanilha" class="btn btn-secondary w-100 mt-2">üìß Enviar Planilha por E-mail</button>
  </div>

  <script>
    const url = 'https://script.google.com/macros/s/AKfycbzHpMU3k8hkmKEohqbKazoP5GdXUjCyPOMOEzUUUVl998DISIcYrkMU4_sbscW2yU2L/exec';

    document.querySelectorAll('.patrimonio').forEach(el => {
      el.addEventListener('input', () => {
        el.value = el.value.replace(/\D/g,'').slice(0,7);
      });
    });

    document.getElementById('patrimonioForm').addEventListener('submit', function(e){
      e.preventDefault();

      const params = new URLSearchParams({
        fullname: document.getElementById('Usuario').value,
        pc: document.getElementById('pc').value,
        lacre: document.getElementById('lacre').value,
        monitor: document.getElementById('monitor').value,
        monitor2: document.getElementById('monitor2').value,
        monitor3: document.getElementById('monitor3').value,
        mesa: document.getElementById('mesa').value,
        telefone: document.getElementById('telefone').value,
        gaveteiro: document.getElementById('gaveteiro').value,
        setor: document.getElementById('setor').value,
        additionalInfo: document.getElementById('additionalInfo').value,
        dataEnvio: new Date().toLocaleString('pt-BR'),
        acao: document.getElementById('acao').value
      });

      fetch(url + '?' + params.toString())
        .then(resp => resp.json())
        .then(json => {
          if(json.status === 'ok'){
            alert('‚úÖ Enviado com sucesso!');
            e.target.reset();
          } else {
            alert('‚ö†Ô∏è Erro: ' + (json.mensagem || 'n√£o processado'));
          }
        })
        .catch(err => alert('‚ùå Erro ao enviar: ' + err));
    });

    // bot√£o separado
    document.getElementById('btnEnviarPlanilha').addEventListener('click', function() {
      if(confirm("Deseja enviar a planilha por e-mail agora?")) {
        fetch(url + '?acao=enviarPlanilha')
          .then(r => r.text())
          .then(t => {
            if(t.includes('OK')) alert('üìß Planilha enviada por e-mail com sucesso!');
            else alert('‚ö†Ô∏è Erro: ' + t);
          })
          .catch(err => alert('‚ùå Falha: ' + err));
      }
    });
  </script>
</body>
</html>
