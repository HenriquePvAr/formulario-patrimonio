<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulário Patrimônio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style> 
    .form-container {max-width:750px;margin:40px auto;padding:24px;background:#fff;border-radius:10px} 
  </style>
</head>
<body>
  <div class="form-container">
    <h3>Formulário de Patrimônio</h3>
    <form id="patrimonioForm" novalidate>
  <div class="mb-3">
    <label>Usuário</label>
    <input id="Usuario" pattern="^[A-Za-zÀ-ÿ\s]+$" title="Apenas letras e espaços" class="form-control"/>
  </div>

  <div class="mb-3">
    <label>Patrimônio Computador</label>
    <input id="pc" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" title="Até 7 dígitos" class="form-control patrimonio"/>
  </div>

  <div class="mb-3">
    <label>Lacre</label>
    <input id="lacre" class="form-control"/>
  </div>

  <div class="mb-3">
    <label>Monitor 1</label>
    <input id="monitor" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
  </div>

  <div class="mb-3">
    <label>Monitor 2 (opcional)</label>
    <input id="monitor2" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
  </div>

  <div class="mb-3">
    <label>Monitor 3 (opcional)</label>
    <input id="monitor3" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
  </div>

  <div class="mb-3">
    <label>Mesa</label>
    <input id="mesa" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
  </div>

  <div class="mb-3">
    <label>Telefone</label>
    <input id="telefone" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
  </div>

  <div class="mb-3">
    <label>Gaveteiro</label>
    <input id="gaveteiro" maxlength="7" inputmode="numeric" pattern="^\d{1,7}$" class="form-control patrimonio"/>
  </div>

  <div class="mb-3">
    <label>Setor</label>
    <select id="setor" required class="form-select">
      <option value="" disabled selected>Selecione</option>
      <option>Almoxarifado</option>
      <option>Anavilhanas</option>
      <option>Brigadista</option>
      <option>Comunicação Social</option>
      <option>Diretoria</option>
      <option>Gabinete</option>
      <option>Hidrologia</option>
      <option>Juami Japurá</option>
      <option>Meteorologia</option>
      <option>Nugep</option>
      <option>Paic</option>
      <option>Pico da Neblina</option>
      <option>Protocolo</option>
      <option>Recepção</option>
      <option>Sala de Treinamento</option>
      <option>Seadm</option>
      <option>Seint</option>
      <option>Setec</option>
      <option>Segurança Orgânica</option>
    </select>
  </div>

  <div class="mb-3">
    <label>Informações Adicionais</label>
    <textarea id="additionalInfo" class="form-control"></textarea>
  </div>

  <div class="mb-3">
    <label>Ação</label>
    <select id="acao" required class="form-select">
      <option value="" disabled selected>Escolha</option>
      <option value="planilha">Enviar para planilha</option>
      <option value="email">Enviar por email</option>
      <option value="planilha_email">Planilha por email</option>
    </select>
  </div>

  <button class="btn btn-primary w-100" type="submit">Enviar</button>
</form>


  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
  <script>
    $(function(){
      // máscara que impede digitar mais de 7 dígitos (apenas números)
      $('.patrimonio').on('input', function(){
        this.value = this.value.replace(/\D/g,'').slice(0,7);
      });

      $('#patrimonioForm').on('submit', function(e){
        e.preventDefault();
        const form = this;
        if(!form.checkValidity()){
          form.reportValidity();
          return;
        }

        const acao = $('#acao').val();
        const setor = $('#setor').val();

        if(!acao || !setor){
          alert('❌ Selecione Ação e Setor antes de enviar.');
          return;
        }

        const params = new URLSearchParams({
          fullname: $('#Usuario').val(),
          pc: $('#pc').val(),
          lacre: $('#lacre').val(),
          monitor: $('#monitor').val(),
          monitor2: $('#monitor2').val(),
          monitor3: $('#monitor3').val(),
          mesa: $('#mesa').val(),
          telefone: $('#telefone').val(),
          gaveteiro: $('#gaveteiro').val(),
          setor: setor,
          additionalInfo: $('#additionalInfo').val(),
          dataEnvio: new Date().toLocaleString('pt-BR'),
          acao: acao
        });

        const url = 'https://script.google.com/macros/s/AKfycbzASVE4mRRA4Kju3dS0VHX_2lIsIMKvsXQlXRVBpxbcsYhi35oL82kwyF3ZYFQaTfty/exec';

        fetch(url + '?' + params.toString(), { method: 'GET' })
          .then(resp => resp.json())
          .then(json => {
            if(json.status === 'ok'){
              alert('✅ Enviado com sucesso!');
              form.reset();
            } else {
              alert('⚠️ Erro: ' + (json.mensagem || 'não processado'));
            }
          })
          .catch(err => {
            console.error(err);
            alert('❌ Erro ao enviar, veja console.');
          });
      });
    });
  </script>
</body>
</html>
